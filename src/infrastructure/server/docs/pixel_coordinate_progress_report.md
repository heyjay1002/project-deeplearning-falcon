# 픽셀 좌표화 작업 진척도 보고서

## 📋 이번 주 완료 작업: "픽셀 좌표화 시스템 구현"

### 🎯 작업 개요
객체 검출 결과의 픽셀 좌표를 맵 좌표계로 변환하고, 구역(AREA) 매핑을 통한 위치 기반 서비스 구현을 완료했습니다.

---

## 🔧 구현된 핵심 기능

### 1. 좌표 변환 시스템
- **bbox 중심점 계산**: 객체 검출 결과 [x1, y1, x2, y2]에서 중심점 추출
- **정규화 좌표 변환**: 픽셀 좌표를 0~1 범위로 정규화
- **맵 좌표 변환**: 정규화 좌표를 맵 크기(960x720)에 맞게 변환

```python
def convert_to_map_coords(self, center_x, center_y, frame_width, frame_height):
    """bbox 중심점 → 맵 좌표 변환"""
    norm_x = center_x / frame_width      # 정규화 좌표
    norm_y = center_y / frame_height
    map_x = norm_x * config.MAP_WIDTH    # 맵 좌표 (960 기준)
    map_y = norm_y * config.MAP_HEIGHT   # 맵 좌표 (720 기준)
    return map_x, map_y, norm_x, norm_y
```

### 2. 구역(AREA) 매핑 시스템
- **DB 기반 구역 관리**: AREA 테이블을 통한 구역 정보 관리
- **실시간 구역 판별**: 객체 위치에 따른 구역 자동 매핑
- **구역별 이벤트 처리**: 구역 진입/이탈 시 이벤트 발생

```python
def find_area_id(self, norm_x, norm_y):
    """정규화 좌표에 해당하는 area_id 반환"""
    for area in self.area_list:
        if area['x1'] <= norm_x <= area['x2'] and area['y1'] <= norm_y <= area['y2']:
            return area['area_id']
    return None
```

### 3. 데이터베이스 연동
- **좌표 정보 저장**: map_x, map_y, area_id를 DETECT_EVENT 테이블에 저장
- **구역 정보 관리**: AREA 테이블을 통한 구역 좌표 관리
- **실시간 업데이트**: 검출 시마다 좌표 정보 자동 업데이트

---

## 📊 구현 결과

### 처리 흐름
1. **객체 검출** → YOLO 모델이 bbox [x1, y1, x2, y2] 제공
2. **중심점 계산** → (center_x, center_y) = ((x1+x2)/2, (y1+y2)/2)
3. **좌표 변환** → 픽셀 → 정규화 → 맵 좌표 변환
4. **구역 매핑** → 정규화 좌표로 구역 판별
5. **DB 저장** → map_x, map_y, area_id 저장

### 성능 지표
- **처리 속도**: 실시간 처리 (30 FPS 기준)
- **정확도**: 픽셀 단위 정밀 좌표 변환
- **확장성**: 구역 추가/수정 시 DB만 업데이트

---

## 🎨 GUI 연동

### 좌표 정보 표시
- **맵 좌표**: GUI에서 바로 사용 가능한 960x720 기준 좌표
- **구역 정보**: 구역명과 함께 위치 정보 제공
- **실시간 업데이트**: 검출 시마다 좌표 정보 갱신

### 메시지 포맷
```
ME_FD: {object_id},{class},{map_x},{map_y},{area_name},{timestamp}
```

---

## 🔍 기술적 특징

### 1. 정규화 좌표계 사용
- 프레임 크기에 관계없이 일관된 좌표 변환
- 카메라 해상도 변경 시에도 안정적 동작

### 2. 구역 겹침 처리
- 여러 구역이 겹칠 경우 첫 번째 매칭 구역 사용
- 우선순위 기반 구역 선택 가능

### 3. 에러 처리
- 좌표 변환 실패 시 안전한 기본값 사용
- DB 연결 오류 시 로깅 및 복구

---

## 📈 향후 확장 계획

### 1. 실세계 좌표 변환
- 카메라 캘리브레이션을 통한 미터 단위 좌표 변환
- GPS 좌표계 연동

### 2. 고급 구역 기능
- 동적 구역 생성/수정
- 구역별 알람 설정
- 구역 통계 분석

### 3. 다중 카메라 지원
- 카메라 간 좌표 통합
- 3D 공간 좌표 변환

---

## ✅ 완료된 작업 체크리스트

- [x] bbox 중심점 계산 로직 구현
- [x] 픽셀 → 정규화 좌표 변환
- [x] 정규화 → 맵 좌표 변환
- [x] 구역 매핑 알고리즘 구현
- [x] DB 테이블 설계 및 구현
- [x] 실시간 좌표 처리 파이프라인 구축
- [x] GUI 연동 및 좌표 표시
- [x] 에러 처리 및 로깅
- [x] 성능 최적화

---

## 🎉 결론

이번 주에 **픽셀 좌표화 시스템**을 성공적으로 구현하여, 객체 검출 결과를 정확한 위치 정보로 변환하고 구역 기반 서비스를 제공할 수 있게 되었습니다. 이를 통해 사용자는 객체의 정확한 위치와 소속 구역을 실시간으로 확인할 수 있으며, 향후 위치 기반 고급 기능 개발의 기반을 마련했습니다.

**핵심 성과**: 실시간 픽셀 좌표 변환 및 구역 매핑 시스템 완성
**기술적 가치**: 확장 가능한 좌표 변환 아키텍처 구축
**비즈니스 가치**: 위치 기반 서비스 기반 마련 